<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Landing Produk</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f7f7f7;
    }
    .product {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
    }
    .product img {
      max-width: 100%;
      border-radius: 5px;
    }
    .product h1 {
      font-size: 24px;
      margin: 10px 0;
    }
    .product .price {
      font-size: 20px;
      color: #e53935;
      font-weight: bold;
    }
    .product .rating {
      color: #fbc02d;
    }
    .product .discount {
      font-size: 14px;
      color: green;
      margin-bottom: 15px;
    }
    .buy-button {
      background: #e53935;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      margin-top: 10px;
    }
    #relatedSection {
      margin-top: 50px;
    }
    #relatedList {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }
    .related-card {
      width: 180px;
      background: white;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .related-card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 5px;
    }
    .related-card .title {
      margin: 10px 0;
      font-weight: bold;
      font-size: 14px;
    }
    .related-card a {
      color: white;
      background: #ff4747;
      padding: 6px 10px;
      text-decoration: none;
      border-radius: 4px;
      display: inline-block;
    }
  </style>
</head>
<body>

<div class="product" id="productInfo">
  <img id="mainImage" src="" alt="Product Image">
  <h1 id="title">Memuat...</h1>
  <div class="price" id="price"></div>
  <div class="rating" id="rating"></div>
  <div class="discount" id="discount"></div>
  <a class="buy-button" id="buyBtn" href="#" target="_blank">Beli Sekarang</a>
</div>

<div id="relatedSection">
  <h2>Produk Terkait</h2>
  <div id="relatedList"></div>
</div>

<script>
const productId = "1005006826121858"; // Ganti dengan ID produk aktif
const workerBase = "https://rebrand.workers.dev"; // Endpoint CSV kamu

function shortenTitle(title) {
  return title.length > 55 ? title.slice(0, 55) + "..." : title;
}

function cleanTitle(title) {
  return title.replace(/[^a-zA-Z0-9\s]/g, "").trim();
}

async function loadProductAndRelated() {
  try {
    const res = await fetch(workerBase + "?csv");
    const csvText = await res.text();
    const rows = csvText.trim().split("\n");

    const header = rows.shift().split(",");
    const products = rows.map(row => {
      const cols = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
      const data = {};
      header.forEach((key, i) => {
        data[key.trim()] = cols[i]?.replace(/^"|"$/g, "").trim() || "";
      });
      return data;
    });

    const product = products.find(p => p.ItemId === productId);
    if (!product) {
      document.getElementById("productInfo").innerHTML = "<p>Produk tidak ditemukan.</p>";
      return;
    }

    // Tampilkan produk utama
    document.getElementById("mainImage").src = product.Image1;
    document.getElementById("title").textContent = product.Title;
    document.getElementById("price").textContent = product.Price;
    document.getElementById("rating").textContent = "⭐ " + product.Star_Rating;
    document.getElementById("discount").textContent = "Diskon: " + product.Discount + "%";
    document.getElementById("buyBtn").href = product.Promote_Url;

    // Produk terkait
    const related = products.filter(p => 
      p.ItemId !== productId && p.Promote_Url && p.Image1
    );
    const randomSix = related.sort(() => Math.random() - 0.5).slice(0, 6);
    const list = document.getElementById("relatedList");
    list.innerHTML = "";

    for (const p of randomSix) {
      const card = document.createElement("div");
      card.className = "related-card";
      card.innerHTML = `
        <img src="${p.Image1}" alt="Product">
        <div class="title">${shortenTitle(cleanTitle(p.Title))}</div>
        <a href="${p.Promote_Url}" target="_blank">Lihat Produk</a>
      `;
      list.appendChild(card);
    }

  } catch (err) {
    console.error("Gagal memuat data:", err);
    document.getElementById("productInfo").innerHTML = "<p>Gagal memuat produk.</p>";
  }
}

loadProductAndRelated();
</script>

</body>
</html>
